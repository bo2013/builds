name: CCBBR For GCC
run-name: building for GCC
on: 
  schedule:
    - cron: '0 17 * * *'
  workflow_dispatch:
jobs:
  Build-gcc:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses:  actions/checkout@v3
        with:
          path: myrepo
        
      - name: Check built version
        run: echo "my_latest=$(git branch -r | grep 'origin/gcc-' | sed 's|.*gcc-||' | sort -V | tail -1)" >> $GITHUB_ENV
        working-directory: ${{ github.workspace }}/myrepo
        
      - name: Clone GCC
        run: |
          git clone --depth 1 --recurse-submodules=no https://gcc.gnu.org/git/gcc.git && cd gcc && echo "gcc_latest=$(git branch -r | grep 'origin/releases/gcc-' | sed 's|.*gcc-||' | sort -V | tail -1)" >> $GITHUB_ENV

      - name: install build tools
        run: sudo apt update && sudo apt install build-essential libgmp-dev libmpfr-dev libmpc-dev libisl-dev
          
      - name: Build
        if: ${{ env.gcc_latest != env.my_latest }}
        run: ./configure && make -j$(nproc) && make install
        working-directory: ${{ github.workspace }}/gcc/
