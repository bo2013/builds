name: CCBBR For GCC
run-name: building for GCC
on: 
  schedule:
    - cron: '0 12 * * *'
    - cron: '0 0 * * *'
  workflow_dispatch:
jobs:
  Build-gcc:
    runs-on: ubuntu-latest
    steps:
      - name: install build tools
        run: sudo apt update && sudo apt install build-essential libgmp-dev libmpfr-dev libmpc-dev libisl-dev
        
      - name: Check built version
        run: echo "gcc_latest=$(git ls-remote --refs https://github.com/bo2013/builds.git 'refs/heads/releases/gcc-*' | awk -F'/' '{print $NF}' | sort -V | tail -1)" >> $GITHUB_ENV
        
      - name: Check GCC version
        run: |
          echo "gcc_latest=$(git ls-remote --refs https://gcc.gnu.org/git/gcc.git 'refs/heads/releases/gcc-*' | awk -F'/' '{print $NF}' | sort -V | tail -1)" >> $GITHUB_ENV

      - name: Log versions
        run: |
          echo "my: ${{ env.my_latest }}"
          echo "GCC: ${{ env.gcc_latest }}"

      - name: Clone GCC
        if: ${{ env.gcc_latest != env.my_latest }}
        run: git clone --depth 1 --branch releases/${{ env.gcc_latest }} --recurse-submodules=no https://gcc.gnu.org/git/gcc.git
